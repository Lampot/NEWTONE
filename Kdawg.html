<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>newtone</title>

<link rel="icon" href="https://i.imgur.com/JNym9an.jpeg" type="image/png">

<!-- Social Preview -->
<meta property="og:title" content="newtone.world">
<meta property="og:image" content="https://i.imgur.com/HeWLUZs.jpeg">
<meta property="og:type" content="website">
<meta property="og:description" content="newtone arts. music. fashion.">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="NEWTONE">
<meta name="twitter:image" content="https://i.imgur.com/HeWLUZs.jpeg">

<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: "Courier New", monospace;
  background: #f2f2f2;
  color: #333;
  height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}
.top-nav {
  width: 100%;
  display: flex;
  justify-content: space-between;
  padding: 10px 20px;
}
.top-nav a {
  text-decoration: none;
  color: #666;
  font-size: 14px;
}
.top-nav a:hover { color: #000; }
.desktop {
  position: relative;
  width: 100%;
  height: calc(100vh - 60px);
  overflow: hidden;
}
.icon {
  position: absolute;
  cursor: grab;
  user-select: none;
  width: 150px;
  height: 150px;
}
.icon img {
  width: 100%;
  height: 100%;
  display: block;
  object-fit: cover;
}
.dragging {
  outline: 2px dotted rgba(0,0,0,.4);
  outline-offset: 4px;
}
footer {
  font-size: 12px;
  margin-bottom: 0;
  color: #888;
  padding: 10px 20px;
  text-align: center;
}
footer a {
  color: #888;
  text-decoration: none;
  margin: 0 8px;
}
footer a:hover { color: #000; }
@media (max-width: 768px) {
  .icon { width: 100px; height: 100px; }
}
.popup {
  position: fixed;
  right: 20px;
  top: 50%;
  transform: translateY(-50%);
  width: 320px;
  background: #fff;
  border-radius: 20px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.35);
  padding: 20px;
  display: none;
  flex-direction: column;
  z-index: 1000;
}
.popup .minimize-btn {
  position: absolute;
  top: 12px;
  right: 12px;
  background: #f0f0f0;
  border: none;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  cursor: pointer;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #666;
  font-size: 20px;
  line-height: 1;
}
.popup .minimize-btn:hover {
  background: #e0e0e0;
}
.popup-header {
  display: flex;
  align-items: center;
  margin-bottom: 15px;
}
.popup-header img {
  width: 60px;
  height: 60px;
  border-radius: 10px;
  margin-right: 15px;
}
.popup-header .info {
  display: flex;
  flex-direction: column;
}
.popup-header .info .name {
  font-weight: bold;
  font-size: 18px;
  margin-bottom: 5px;
}
.popup-header .info .artist {
  font-size: 14px;
  color: grey;
  margin-bottom: 5px;
}
.popup-header .info .credits {
  font-size: 12px;
  color: #666;
  text-decoration: none;
}
.track-list {
  list-style: none;
  padding: 0;
  margin: 0 0 20px 0;
  flex-grow: 1;
  max-height: 200px;
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: #ccc #f0f0f0;
}
.track-list::-webkit-scrollbar {
  width: 6px;
}
.track-list::-webkit-scrollbar-track {
  background: #f0f0f0;
  border-radius: 3px;
}
.track-list::-webkit-scrollbar-thumb {
  background: #ccc;
  border-radius: 3px;
}
.track-list::-webkit-scrollbar-thumb:hover {
  background: #999;
}
.track-list li {
  padding: 10px 0;
  cursor: pointer;
  border-bottom: 1px solid #eee;
  font-size: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.track-list li:last-child {
  border-bottom: none;
}
.track-list li:hover { 
  background: #f0f0f0; 
  padding-left: 5px;
  padding-right: 5px;
}
.track-list li span.track-title {
  flex-grow: 1;
  cursor: pointer;
}
.track-list li .queue-add {
  color: #888;
  cursor: pointer;
  padding: 0 8px;
  user-select: none;
  font-weight: bold;
  min-width: 20px;
  text-align: center;
}
.track-list li .queue-add.added {
  color: #007aff;
}

.button-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-top: 15px;
  padding-top: 12px;
  border-top: 1px solid #eee;
}
.play-group {
  display: flex;
  align-items: center;
  gap: 16px;
}
.button-row button,
.button-row .volume-control {
  display: flex;
  align-items: center;
  justify-content: center;
  background: none;
  border: none;
  cursor: pointer;
  width: 40px;
  height: 40px;
  padding: 0;
  margin: 0;
}
.button-row button img,
.button-row .volume-control img {
  width: 24px;
  height: 24px;
  display: block;
}
#skip-forward img,
#mini-skip-forward img {
  transform: scaleX(-1);
}
#skip-forward-forward img,
#mini-skip-forward-forward img {
  transform: none;
}

.progress-container {
  height: 6px;
  background: #e0e0e0;
  border-radius: 3px;
  cursor: pointer;
  margin-top: 20px;
  width: 100%;
}
.progress-bar {
  height: 100%;
  width: 0%;
  background: #007aff;
  border-radius: 3px;
  transition: width 0.1s ease;
}

.volume-control {
  position: relative;
  cursor: pointer;
}
.volume-slider {
  position: absolute;
  bottom: 90px;
  left: 50%;
  transform: translateX(-50%) rotate(-90deg);
  width: 100px;
  height: 6px;
  -webkit-appearance: none;
  appearance: none;
  background: #e0e0e0;
  border-radius: 3px;
  outline: none;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s ease, visibility 0.2s;
  z-index: 10;
}
.volume-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 16px;
  height: 16px;
  background: #007aff;
  border-radius: 50%;
  cursor: pointer;
}
.volume-slider::-moz-range-thumb {
  width: 16px;
  height: 16px;
  background: #007aff;
  border-radius: 50%;
  cursor: pointer;
  border: none;
}
.volume-control:hover .volume-slider {
  opacity: 1;
  visibility: visible;
}

/* ✨ CREDITS POPUP */
#credits-popup {
  position: fixed;
  width: 280px;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.4);
  padding: 20px;
  z-index: 2000;
  cursor: grab;
  display: none;
}
#credits-popup.dragging {
  cursor: grabbing;
}
#credits-popup h3 {
  margin: 0 0 12px 0;
  font-size: 18px;
  font-weight: bold;
}
#credits-popup p {
  margin: 6px 0;
  font-size: 14px;
}
#credits-popup .section {
  margin-bottom: 14px;
}
#credits-popup .close-btn {
  position: absolute;
  top: 12px;
  right: 12px;
  background: #f0f0f0;
  border: none;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  cursor: pointer;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #666;
}
#credits-popup .close-btn:hover {
  background: #e0e0e0;
}

/* ✨ MINI PLAYER */
#mini-player {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  padding: 12px;
  display: none;
  flex-direction: row;
  align-items: center;
  gap: 12px;
  z-index: 1100;
  width: 300px;
  max-width: calc(100% - 20px);
}
#mini-player.dragging {
  cursor: grabbing;
}
#mini-player img {
  width: 50px;
  height: 50px;
  border-radius: 8px;
  object-fit: cover;
}
#mini-player .track-info {
  flex-grow: 1;
  overflow: hidden;
}
#mini-player .track-info .song-title {
  font-size: 14px;
  font-weight: bold;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
#mini-player .controls {
  display: flex;
  align-items: center;
  gap: 10px;
}
#mini-player .controls button {
  background: none;
  border: none;
  cursor: pointer;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}
#mini-player .controls img {
  width: 20px;
  height: 20px;
}
#mini-player .restore-btn {
  background: #f0f0f0;
  border: none;
  width: 28px;
  height: 28px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #666;
}
#mini-player .restore-btn:hover {
  background: #e0e0e0;
}

/* ✨ QUEUE POPUP */
#queue-popup {
  position: fixed;
  right: 20px;
  bottom: 80px;
  width: 320px;
  background: #fff;
  border-radius: 20px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.35);
  padding: 20px;
  display: none;
  flex-direction: column;
  z-index: 1000;
}
#queue-popup .close-btn {
  position: absolute;
  top: 12px;
  right: 12px;
  background: #f0f0f0;
  border: none;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  cursor: pointer;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #666;
  font-size: 18px;
}
#queue-popup .close-btn:hover {
  background: #e0e0e0;
}
#queue-list {
  list-style: none;
  padding: 0;
  margin: 10px 0 0 0;
  max-height: 200px;
  overflow-y: auto;
}
#queue-list li {
  padding: 8px 0;
  border-bottom: 1px solid #eee;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 14px;
}
#queue-list li button {
  background: none;
  border: none;
  color: #888;
  font-size: 18px;
  cursor: pointer;
}
</style>
</head>
<body>

<div class="top-nav">
  <a href="https://open.spotify.com/artist/6NvjKnOvxSoVbuv4uDhBgw?si=yjT02rTLQD6q53iWzrOo9Q" target="_blank">music</a>
  <a href="https://genius.com/artists/K1dawg" target="_blank">lyrics</a>
</div>

<div class="desktop" id="desktop">
  <a href="#" class="icon" id="icon-1">
    <img src="https://i.imgur.com/DN8IHkK.jpeg" alt="ART" />
  </a>


<!-- Main Album Popup -->
<div class="popup" id="album-popup">
  <button class="minimize-btn" id="minimize-btn">–</button>

  <div class="popup-header">
    <img id="popup-cover" src="" alt="cover" />
    <div class="info">
      <div class="name" id="popup-name">Album Name</div>
      <div class="artist" id="popup-artist">Artist Name</div>
      <div style="display: flex; gap: 12px; align-items: center;">
        <a href="#" class="credits" id="queue-btn" style="color: grey; font-size: 14px; text-decoration: none;">queue →</a>
        <a href="#" class="credits" id="credits-btn">credits →</a>
      </div>
    </div>
  </div>
  <ul class="track-list" id="track-list"></ul>

  <div class="button-row">
    <div class="volume-control">
      <input type="range" class="volume-slider" id="volume-bar" min="0" max="1" step="0.01" value="1"/>
      <img src="https://img.icons8.com/ios-filled/50/000000/medium-volume.png" id="volume-icon"/>
    </div>

    <div class="play-group">
      <button id="skip-back">
        <img src="https://img.icons8.com/ios-filled/50/000000/rewind--v1.png" />
      </button>
      <button id="play-pause">
        <img src="https://img.icons8.com/ios-filled/50/000000/play--v1.png" id="play-icon"/>
      </button>
      <button id="skip-forward">
        <img src="https://img.icons8.com/ios-filled/50/000000/rewind--v1.png" id="skip-forward-img"/>
      </button>
    </div>

    <button class="download">
      <img src="https://img.icons8.com/ios-filled/50/000000/download--v1.png" id="download-icon"/>
    </button>
  </div>

  <div class="progress-container" id="progress-container">
    <div class="progress-bar" id="progress-bar"></div>
  </div>

  <audio id="audio-player"></audio>
</div>

<!-- ✨ CREDITS POPUP -->
<div id="credits-popup">
  <button class="close-btn">×</button>
  <h3 id="credits-title">Credits</h3>
  <div class="section">
    <strong>Features:</strong>
    <p id="credits-features">—</p>
  </div>
  <div class="section">
    <strong>Producers:</strong>
    <p id="credits-producers">—</p>
  </div>
</div>

<!-- ✨ MINI PLAYER -->
<div id="mini-player">
  <img id="mini-cover" src="" alt="cover" />
  <div class="track-info">
    <div class="song-title" id="mini-title">—</div>
  </div>
  <div class="controls">
    <button id="mini-skip-back">
      <img src="https://img.icons8.com/ios-filled/50/000000/rewind--v1.png" />
    </button>
    <button id="mini-play-pause">
      <img src="https://img.icons8.com/ios-filled/50/000000/play--v1.png" id="mini-play-icon"/>
    </button>
    <button id="mini-skip-forward">
      <img src="https://img.icons8.com/ios-filled/50/000000/rewind--v1.png" id="mini-skip-forward-img"/>
    </button>
  </div>
  <button class="restore-btn" id="restore-btn">⤢</button>
</div>

<!-- ✨ QUEUE POPUP -->
<div id="queue-popup">
  <button class="close-btn" id="close-queue">×</button>
  <strong style="font-size: 16px;">Up Next</strong>
  <ul id="queue-list"></ul>
</div>

<!-- ⚠️ CONTENT WARNING POPUP -->
<div id="warning-popup" style="
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.7);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 3000;
">
  <div style="
    background: #fff;
    padding: 24px;
    border-radius: 16px;
    max-width: 400px;
    text-align: center;
    font-family: 'Courier New', monospace;
    color: #333;
  ">
    <h3>Content Warning</h3>
    <p>This content may contain explicit material.</p>
    <div style="margin-top: 20px; display: flex; gap: 12px; justify-content: center;">
      <button id="warning-cancel" style="padding: 8px 16px; background: #f0f0f0; border: none; border-radius: 8px; cursor: pointer;">Cancel</button>
      <button id="warning-proceed" style="padding: 8px 16px; background: #007aff; color: white; border: none; border-radius: 8px; cursor: pointer;">Proceed</button>
    </div>
  </div>
</div>

<script>
function getRandomPosition(parent, el) {
  const parentWidth = parent.clientWidth;
  const parentHeight = parent.clientHeight;
  const elWidth = el.offsetWidth;
  const elHeight = el.offsetHeight;
  return { left: Math.random() * (parentWidth - elWidth) + 'px', top: Math.random() * (parentHeight - elHeight) + 'px' };
}

function makeDraggable(el, constrain = false) {
  let offsetX = 0, offsetY = 0, isDragging = false;
  el.style.position = 'absolute';
  el.addEventListener('mousedown', e => {
    if (e.target.classList.contains('close-btn') || e.target.classList.contains('minimize-btn') || e.target.classList.contains('restore-btn')) return;
    if (constrain && e.target.closest('.controls')) return;
    e.preventDefault();
    const rect = el.getBoundingClientRect();
    offsetX = e.clientX - rect.left;
    offsetY = e.clientY - rect.top;
    isDragging = true;
    el.classList.add('dragging');
    function onMouseMove(ev) {
      if (!isDragging) return;
      let x = ev.clientX - offsetX;
      let y = ev.clientY - offsetY;
      if (constrain) {
        const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;
        x = Math.max(0, Math.min(x, screenWidth - el.offsetWidth));
        y = Math.max(0, Math.min(y, screenHeight - el.offsetHeight));
      }
      el.style.left = x + 'px';
      el.style.top = y + 'px';
    }
    function onMouseUp() {
      isDragging = false;
      el.classList.remove('dragging');
      document.removeEventListener('mousemove', onMouseMove);
      document.removeEventListener('mouseup', onMouseUp);
    }
    document.addEventListener('mousemove', onMouseMove);
    document.addEventListener('mouseup', onMouseUp);
  });
}

function drag(el) {
  const parent = document.getElementById('desktop');
  let offsetX = 0, offsetY = 0, isDragging = false;
  el.style.position = 'absolute';
  const saved = localStorage.getItem(el.id);
  if (saved) {
    const pos = JSON.parse(saved);
    el.style.left = pos.left;
    el.style.top = pos.top;
  } else {
    const randomPos = getRandomPosition(parent, el);
    el.style.left = randomPos.left;
    el.style.top = randomPos.top;
  }
  el.addEventListener('mousedown', e => {
    e.preventDefault();
    const rect = el.getBoundingClientRect();
    const parentRect = parent.getBoundingClientRect();
    offsetX = e.clientX - rect.left;
    offsetY = e.clientY - rect.top;
    isDragging = true;
    el.classList.add('dragging');
    function onMouseMove(ev) {
      if (!isDragging) return;
      let x = ev.clientX - parentRect.left - offsetX;
      let y = ev.clientY - parentRect.top - offsetY;
      x = Math.max(0, Math.min(x, parent.clientWidth - el.offsetWidth));
      y = Math.max(0, Math.min(y, parent.clientHeight - el.offsetHeight));
      el.style.left = x + 'px';
      el.style.top = y + 'px';
      localStorage.setItem(el.id, JSON.stringify({ left: el.style.left, top: el.style.top }));
    }
    function onMouseUp() {
      isDragging = false;
      el.classList.remove('dragging');
      document.removeEventListener('mousemove', onMouseMove);
      document.removeEventListener('mouseup', onMouseUp);
    }
    document.addEventListener('mousemove', onMouseMove);
    document.addEventListener('mouseup', onMouseUp);
  });
  el.addEventListener('click', () => openAlbumPopup(el.id));
}

// Audio logic
const audioPlayer = document.getElementById('audio-player');
const playBtn = document.getElementById('play-pause');
const playIcon = document.getElementById('play-icon');
const skipBackBtn = document.getElementById('skip-back');
const skipForwardBtn = document.getElementById('skip-forward');
const progressContainer = document.getElementById('progress-container');
const progressBar = document.getElementById('progress-bar');
const volumeBar = document.getElementById('volume-bar');
const volumeIcon = document.getElementById('volume-icon');
const downloadBtn = document.querySelector('.download');
const creditsBtn = document.getElementById('credits-btn');
const creditsPopup = document.getElementById('credits-popup');
const creditsTitle = document.getElementById('credits-title');
const creditsFeatures = document.getElementById('credits-features');
const creditsProducers = document.getElementById('credits-producers');
const closeCreditsBtn = document.querySelector('#credits-popup .close-btn');
const minimizeBtn = document.getElementById('minimize-btn');
const miniPlayer = document.getElementById('mini-player');
const miniCover = document.getElementById('mini-cover');
const miniTitle = document.getElementById('mini-title');
const miniPlayBtn = document.getElementById('mini-play-pause');
const miniPlayIcon = document.getElementById('mini-play-icon');
const miniSkipBack = document.getElementById('mini-skip-back');
const miniSkipForward = document.getElementById('mini-skip-forward');
const restoreBtn = document.getElementById('restore-btn');

let currentTrackIndex = 0;
let currentTrackList = [];
let lastVolume = 1;
let currentAlbumId = null;
let currentTrackName = '—';
let isPlayingFromQueue = false;

const preloadedAudios = {};

// QUEUE SYSTEM
let playQueue = [];

function addToQueue(albumId, trackIndex, plusBtn) {
  const album = albumData[albumId];
  const track = album.tracks[trackIndex];
  if (!track.src) return;

  const alreadyInQueue = playQueue.some(q => q.albumId === albumId && q.trackIndex === trackIndex);
  if (alreadyInQueue) return;

  playQueue.push({
    albumId,
    trackIndex,
    name: track.name,
    src: track.src,
    cover: album.cover,
    albumName: album.name
  });

  plusBtn.textContent = '✓';
  plusBtn.classList.add('added');
  renderQueue();
}

function renderQueue() {
  const queueList = document.getElementById('queue-list');
  queueList.innerHTML = '';
  playQueue.forEach((item, index) => {
    const li = document.createElement('li');
    li.innerHTML = `
      <span style="overflow: hidden; text-overflow: ellipsis;">${item.name}</span>
      <button class="remove-from-queue" data-index="${index}">×</button>
    `;
    queueList.appendChild(li);
  });

  document.querySelectorAll('.remove-from-queue').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const idx = parseInt(e.target.dataset.index);
      playQueue.splice(idx, 1);
      renderQueue();
    });
  });
}

function playTrack(src, index, trackList, name, fromQueue = false, queueItem = null) {
  if (!src) {
    currentTrackName = name || '—';
    updateMiniPlayer();
    return;
  }
  audioPlayer.src = src;
  audioPlayer.play();
  playIcon.src = 'https://img.icons8.com/ios-filled/50/000000/pause--v1.png';
  miniPlayIcon.src = 'https://img.icons8.com/ios-filled/50/000000/pause--v1.png';
  currentTrackIndex = index;
  currentTrackList = fromQueue ? [] : trackList || [];
  currentTrackName = name || '—';
  isPlayingFromQueue = fromQueue;
  if (fromQueue && queueItem) {
    currentAlbumId = queueItem.albumId;
  }
  updateMiniPlayer();
}

const albumData = {
  'icon-1': {
    name: 'Guilt By Association',
    artist: 'KDawg, DYLN',
    cover: 'https://i.imgur.com/DN8IHkK.jpeg',
    tracks: [
      { name: '1. DIFFERENCES', src: 'https://raw.githubusercontent.com/Lampot/NEWTONE/main/Music/Differences.mp3' },
      { name: '2. NIRVANA', src: 'https://raw.githubusercontent.com/Lampot/NEWTONE/main/Music/NIRVANA.mp3' },
      { name: '3. FUCK A DOWNGRADE', src: 'https://raw.githubusercontent.com/Lampot/NEWTONE/main/Music/Fuck%20a%20Downgrade.mp3' },
      { name: '4. FEAR ME', src: 'https://raw.githubusercontent.com/Lampot/NEWTONE/main/Music/FEAR%20ME.mp3' },
      { name: '5. BIG AMBITION', src: 'https://raw.githubusercontent.com/Lampot/NEWTONE/main/Music/Big%20Ambition.mp3' },
    ]
  },

};

let pendingAlbumId = null;

function openAlbumPopup(albumId) {
  if (albumId === 'icon-3' || albumId === 'icon-4') {
    pendingAlbumId = albumId;
    document.getElementById('warning-popup').style.display = 'flex';
    return;
  }
  _openAlbumPopup(albumId);
}

function _openAlbumPopup(albumId) {
  miniPlayer.style.display = 'none';

  const popup = document.getElementById('album-popup');
  const cover = document.getElementById('popup-cover');
  const name = document.getElementById('popup-name');
  const artist = document.getElementById('popup-artist');
  const trackList = document.getElementById('track-list');

  const album = albumData[albumId];
  cover.src = album.cover;
  name.textContent = album.name;
  artist.textContent = album.artist;
  trackList.innerHTML = '';

  if (!preloadedAudios[albumId]) {
    preloadedAudios[albumId] = {};
  }

  album.tracks.forEach((track, index) => {
    const li = document.createElement('li');

    const titleSpan = document.createElement('span');
    titleSpan.className = 'track-title';
    titleSpan.textContent = track.name;

    const plusBtn = document.createElement('span');
    plusBtn.className = 'queue-add';
    plusBtn.textContent = '+';

    li.appendChild(titleSpan);
    li.appendChild(plusBtn);

    if (track.src && !preloadedAudios[albumId][index]) {
      const preloadAudio = new Audio(track.src);
      preloadAudio.preload = 'auto';
      preloadAudio.load();
      preloadedAudios[albumId][index] = preloadAudio;
    }

    titleSpan.addEventListener('click', () => {
      audioPlayer.src = track.src;
      audioPlayer.play();
      playIcon.src = 'https://img.icons8.com/ios-filled/50/000000/pause--v1.png';
      miniPlayIcon.src = 'https://img.icons8.com/ios-filled/50/000000/pause--v1.png';
      currentTrackIndex = index;
      currentTrackList = album.tracks;
      currentTrackName = track.name;
      currentAlbumId = albumId;
      isPlayingFromQueue = false;
      updateMiniPlayer();
    });

    plusBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      addToQueue(albumId, index, plusBtn);
      document.getElementById('queue-popup').style.display = 'flex';
    });

    trackList.appendChild(li);
  });

  currentTrackList = album.tracks;
  currentAlbumId = albumId;
  popup.style.display = 'flex';
  currentTrackName = '—';
  updateMiniPlayer();
}

function updateMiniPlayer() {
  const album = albumData[currentAlbumId];
  if (album) {
    miniCover.src = album.cover;
  }
  miniTitle.textContent = currentTrackName;
}

playBtn.addEventListener('click', () => {
  if (audioPlayer.paused) {
    audioPlayer.play();
    playIcon.src = 'https://img.icons8.com/ios-filled/50/000000/pause--v1.png';
    miniPlayIcon.src = 'https://img.icons8.com/ios-filled/50/000000/pause--v1.png';
  } else {
    audioPlayer.pause();
    playIcon.src = 'https://img.icons8.com/ios-filled/50/000000/play--v1.png';
    miniPlayIcon.src = 'https://img.icons8.com/ios-filled/50/000000/play--v1.png';
  }
});

miniPlayBtn.addEventListener('click', () => playBtn.click());

skipBackBtn.addEventListener('click', () => {
  if (currentTrackList.length === 0 && playQueue.length === 0) return;
  if (isPlayingFromQueue || currentTrackIndex === 0) {
    return;
  }
  currentTrackIndex = Math.max(0, currentTrackIndex - 1);
  const track = currentTrackList[currentTrackIndex];
  if (track && track.src) {
    playTrack(track.src, currentTrackIndex, currentTrackList, track.name);
  }
});

miniSkipBack.addEventListener('click', () => skipBackBtn.click());

skipForwardBtn.addEventListener('click', () => {
  if (playQueue.length > 0) {
    const nextInQueue = playQueue.shift();
    renderQueue();
    playTrack(nextInQueue.src, 0, [], nextInQueue.name, true, nextInQueue);
    return;
  }

  if (currentTrackList.length === 0) return;
  currentTrackIndex = Math.min(currentTrackList.length - 1, currentTrackIndex + 1);
  const track = currentTrackList[currentTrackIndex];
  if (track && track.src) {
    playTrack(track.src, currentTrackIndex, currentTrackList, track.name);
  } else {
    currentTrackName = track ? track.name : '—';
    updateMiniPlayer();
  }
});

miniSkipForward.addEventListener('click', () => document.getElementById('skip-forward').click());

audioPlayer.addEventListener('timeupdate', () => {
  if (audioPlayer.duration) {
    const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
    progressBar.style.width = percent + '%';
  }
});

audioPlayer.addEventListener('ended', () => {
  if (playQueue.length > 0) {
    const nextInQueue = playQueue.shift();
    renderQueue();
    playTrack(nextInQueue.src, 0, [], nextInQueue.name, true, nextInQueue);
    return;
  }

  if (currentTrackList.length === 0 || currentTrackIndex >= currentTrackList.length - 1) {
    playIcon.src = 'https://img.icons8.com/ios-filled/50/000000/play--v1.png';
    miniPlayIcon.src = 'https://img.icons8.com/ios-filled/50/000000/play--v1.png';
    return;
  }

  currentTrackIndex++;
  const nextTrack = currentTrackList[currentTrackIndex];
  if (nextTrack && nextTrack.src) {
    playTrack(nextTrack.src, currentTrackIndex, currentTrackList, nextTrack.name);
  } else {
    currentTrackName = nextTrack ? nextTrack.name : '—';
    updateMiniPlayer();
    playIcon.src = 'https://img.icons8.com/ios-filled/50/000000/play--v1.png';
    miniPlayIcon.src = 'https://img.icons8.com/ios-filled/50/000000/play--v1.png';
  }
});

progressContainer.addEventListener('click', e => {
  const rect = progressContainer.getBoundingClientRect();
  const percent = (e.clientX - rect.left) / rect.width;
  audioPlayer.currentTime = percent * audioPlayer.duration;
});

volumeBar.addEventListener('input', () => {
  audioPlayer.volume = volumeBar.value;
  if (audioPlayer.volume === 0) {
    volumeIcon.src = 'https://img.icons8.com/ios-filled/50/000000/mute.png';
  } else {
    volumeIcon.src = 'https://img.icons8.com/ios-filled/50/000000/medium-volume.png';
  }
});

volumeIcon.addEventListener('click', () => {
  if (audioPlayer.volume > 0) {
    lastVolume = audioPlayer.volume;
    audioPlayer.volume = 0;
    volumeBar.value = 0;
    volumeIcon.src = 'https://img.icons8.com/ios-filled/50/000000/mute.png';
  } else {
    audioPlayer.volume = lastVolume;
    volumeBar.value = lastVolume;
    volumeIcon.src = 'https://img.icons8.com/ios-filled/50/000000/medium-volume.png';
  }
});

downloadBtn.addEventListener('click', () => {
  if (audioPlayer.src) {
    const a = document.createElement('a');
    a.href = audioPlayer.src;
    a.download = audioPlayer.src.split('/').pop().split('?')[0];
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }
});

const albumCredits = {
  'icon-1': {
    title: 'Guilt By Association – Credits',
    features: ['KDawg, DYLNMBRY'],
    producers: ['DYLNMBRY']
  },

};

creditsBtn.addEventListener('click', (e) => {
  e.preventDefault();
  if (!currentAlbumId) return;

  const creditsData = albumCredits[currentAlbumId];
  creditsTitle.textContent = creditsData.title;
  creditsFeatures.innerHTML = creditsData.features.map(f => `• ${f}`).join('<br>');
  creditsProducers.innerHTML = creditsData.producers.map(p => `• ${p}`).join('<br>');

  const mainPopup = document.getElementById('album-popup');
  const rect = mainPopup.getBoundingClientRect();
  creditsPopup.style.left = (rect.left - 300) + 'px';
  creditsPopup.style.top = (rect.top + 50) + 'px';
  creditsPopup.style.display = 'block';
});

closeCreditsBtn.addEventListener('click', () => {
  creditsPopup.style.display = 'none';
});

makeDraggable(creditsPopup);

minimizeBtn.addEventListener('click', () => {
  document.getElementById('album-popup').style.display = 'none';
  miniPlayer.style.display = 'flex';
  updateMiniPlayer();
});

restoreBtn.addEventListener('click', () => {
  miniPlayer.style.display = 'none';
  document.getElementById('album-popup').style.display = 'flex';
});

makeDraggable(miniPlayer, true);

document.getElementById('queue-btn').addEventListener('click', (e) => {
  e.preventDefault();
  document.getElementById('queue-popup').style.display = 'flex';
});

document.getElementById('close-queue').addEventListener('click', () => {
  document.getElementById('queue-popup').style.display = 'none';
});

makeDraggable(document.getElementById('queue-popup'));

// Warning popup handlers
document.getElementById('warning-cancel').addEventListener('click', () => {
  document.getElementById('warning-popup').style.display = 'none';
  pendingAlbumId = null;
});

document.getElementById('warning-proceed').addEventListener('click', () => {
  document.getElementById('warning-popup').style.display = 'none';
  if (pendingAlbumId) {
    _openAlbumPopup(pendingAlbumId);
    pendingAlbumId = null;
  }
});

['icon-1'].forEach(id => drag(document.getElementById(id)));

</script>

</body>

</html>
